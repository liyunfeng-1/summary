# http2.0和http3.0和https对比

## **一、HTTP协议**

HTTP协议是HyperText Transfer Protocol（超文本传输协议）的缩写，它是互联网上应用最为广泛的一种网络协议。所有的WWW文件都必须遵守这个标准。伴随着计算机网络和浏览器的诞生，HTTP1.0也随之而来，处于计算机网络中的应用层，HTTP是建立在TCP协议之上，所以**HTTP协议的瓶颈及其优化技巧都是基于TCP协议本身的特性**，例如tcp建立连接的3次握手和断开连接的4次挥手以及每次建立连接带来的RTT延迟时间。

## **HTTP/2 新特性**

### **1. 二进制传输**

HTTP/2 采用二进制格式传输数据，而非 HTTP 1.x 的文本格式，二进制协议解析起来更高效。 HTTP / 1 的请求和响应报文，都是由起始行，首部和实体正文（可选）组成，各部分之间以文本换行符分隔。**HTTP/2 将请求和响应数据分割为更小的帧，并且它们采用二进制编码**。

接下来我们介绍几个重要的概念：

- 流：流是连接中的一个虚拟信道，可以承载双向的消息；每个流都有一个唯一的整数标识符（1、2…N）；

- 消息：是指逻辑上的 HTTP 消息，比如请求、响应等，由一或多个帧组成。

- 帧：HTTP 2.0 通信的最小单位，每个帧包含帧首部，至少也会标识出当前帧所属的流，承载着特定类型的数据，如 HTTP 首部、负荷，等等

- ![img](https://pic4.zhimg.com/80/v2-13652bf03136b73af83d01f0b07f6ee3_720w.jpg)

  

  HTTP/2 中，同域名下所有通信都在单个连接上完成，该连接可以承载任意数量的双向数据流。每个数据流都以消息的形式发送，而消息又由一个或多个帧组成。多个帧之间可以乱序发送，根据帧首部的流标识可以重新组装。



### **2. 多路复用**

在 HTTP/2 中引入了多路复用的技术。多路复用很好的解决了浏览器限制同一个域名下的请求数量的问题，同时也接更容易实现全速传输，毕竟新开一个 TCP 连接都需要慢慢提升传输速度。

### **3. Header 压缩**

在 HTTP/1 中，我们使用文本的形式传输 header，在 header 携带 cookie 的情况下，可能每次都需要重复传输几百到几千的字节

### **4. Server Push**

Server Push即服务端能通过push的方式将客户端需要的内容预先推送过去，也叫“cache push”。

## **HTTP/3 新特性**

### **1. HTTP/3简介**

虽然 HTTP/2 解决了很多之前旧版本的问题，但是它还是存在一个巨大的问题，主要是底层支撑的 TCP 协议造成的。

上文提到 HTTP/2 使用了多路复用，一般来说同一域名下只需要使用一个 TCP 连接。但当这个连接中出现了丢包的情况，那就会导致 HTTP/2 的表现情况反倒不如 HTTP/1 了。

因为在出现丢包的情况下，整个 TCP 都要开始等待重传，也就导致了后面的所有数据都被阻塞了。但是对于 HTTP/1.1 来说，可以开启多个 TCP 连接，出现这种情况反到只会影响其中一个连接，剩余的 TCP 连接还可以正常传输数据。

那么可能就会有人考虑到去修改 TCP 协议，其实这已经是一件不可能完成的任务了。因为 TCP 存在的时间实在太长，已经充斥在各种设备中，并且这个协议是由操作系统实现的，更新起来不大现实。

基于这个原因，**Google 就更起炉灶搞了一个基于 UDP 协议的 QUIC 协议，并且使用在了 HTTP/3 上**，HTTP/3 之前名为 HTTP-over-QUIC，从这个名字中我们也可以发现，HTTP/3 最大的改造就是使用了 QUIC。

### 那么Quic是什么？

Quic(QuickUDP Internet Connections)是一种新的传输方式，与TCP相比，它减少了延迟。表面上，Quic非常类似于在UDP上实现的TCP+TLS+HTTP/2。由于TCP是在操作系统内核和中间件固件中实现的，因此对TCP进行重大更改几乎是不可能的。然而，由于Quic是构建在UDP之上的，所以它没有受到这样的限制。

**Quic在现有TCP+TLS+HTTP 2上的关键特性包括**

- 大大缩短连接建立时间
- 改进的拥塞控制
- 无线头阻塞的多路复用
- 前向纠错
- 连接迁移

## HTTPS

HTTPS 是最流行的 HTTP 安全形式，由网景公司首创，所有主要的浏览器和服务器都支持此协议。 使用 HTTPS 时，所有的 HTTP 请求和响应数据在发送之前，都要进行加密。加密可以使用 SSL 或 TLS。

- 对称加密：

- - 加密和解密都是用同一个密钥

- 非对称加密：

- - 加密用公开的密钥，解密用私钥
  - (私钥只有自己知道，公开的密钥大家都知道)

- 数字签名：

- - 验证传输的内容**是对方发送的数据**
  - 发送的数据**没有被篡改过**

- 数字证书（Certificate Authority）简称CA

- - 认证机构证明是**真实的服务器发送的数据**。



私钥：放在服务器。

公钥：放在互联网上， 所有人都可以拿到的加密的字符串。这个字符串用来加密我们传输的信息。使用公钥加密的数据传输到服务器上之后，只有服务器通过私钥进行解密，才能把公钥加密过的数据给解密出来。任何人都拿不到私钥，因为私钥只放在服务器上。不会放到互联网上进行传输。

公钥和私钥，在握手的时候进行传输。

HTTPS传输的过程

![img](https://pic4.zhimg.com/80/v2-b4966edb67956d7643e2dac0154ed733_720w.jpg)

1、客户端先生成一个随机数，传输给服务端，中间会带上客户端支持的加密套件。

2、服务端拿到这个随机数之后，先保存，也生成一个随机数，会伴随着一个证书，也就是公钥，传输给客户端。

3、客户端收到服务端传来的随机数和公钥，也保存下，然后生成一个预主秘钥，也就是第三个随机数，这个随机数用公钥加密了，传输给服务器。

4、服务端收到加密的预主秘钥，使用私钥进行解密，拿到预主秘钥，客户端和服务端同时对这三个随机数进行算法的操作，生成一个主秘钥。后期传输的数据都是通过这个主秘钥进行加密的。

HTTPS默认使用的端口：443

需要第三方权威机构来颁发安全证书。