## 前端vue单页面框架分模块打包

这个架构是把社会治理统一平台当做一个工程，平台里面的子系统当做业务模块。是基于webpack，将模块拆分成基础模块和 N 个业务模块，基础模块作为业务模块插槽，业务模块则独立开发和更新，并且业务模块使用时为懒加载。

1. 用户体验和单页项目一致（本身就是单页）。
2. 负责不同模块的小组技术栈甚至代码风格是一致的，能更好应对紧急情况下的人员调动。

虽然可能由不同小组负责不同业务模块，但技术选型、代码风格和打包都依赖于基础模块，所以规范方面都是可以在基础模块严格控制的。

## 前端架构可以解决的问题

1. 在一个工程的基础上模块可以独立打包，独立开发和更新，解决工程包很大，每次一起发布的问题
2. 公共资源可以独立打包
3. 基础工程和业务模块可以共享组件
4. 有基础模块加载业务模块路由，可以后台控制加载的路由
5. 在平台中的子系统没有独立的打算，所以架构设计把每个子系统以业务模块的形式存在

## 工程构建的步骤

该架构下，工程的完整打包流程为如下所示：
1. `npm run dll`为打包公共资源文件，构建后的目录`dll`，只有第一次打包时需要。 
2. `npm run mod xxx`为打包模块`xxx`为模块名称，构建后的目录`modules`，业务模块改变后才需要重新打包。 
3. `npm run build`为打包基础模块，构建后的目录`dist`，基础模块改变后才需要重新打包。
5. 除去第一次构建外，每次业务模块更新版本打包后可以替换对应的业务模块。

## 路由配置说明

1. 业务模块中通过`registeredRouter`方法进行路由注册，具体方法封装在`@/utils/module`中
3. 前端路由可以通过后端配置进行权限控制，具体json例子在`static/base.json`中
```json
{
  "menuList": [
	{
      "id":"0",
      "title":"全景数据",
      "path":"map/fullView"
    }
  ]
}
```
4. 路由注册查找规则是根据配置的`path`的值`map/fullView`，通过根目录`map`去匹配模块，所以根目录的名称要和模块名称一致
5. 每次登录通过`permission.js`查询路由权限，动态加载路由

## 业务模块打包配置说明

1. 业务模块打包配置文件`webpack.mod.conf.js`
2. 要实现分模块打包首先不能让webpack识别否则会打包到一起，所以最后使用requirejs的方式引入模块
3. 配置`libraryTarget`，通过打包库文件的方式进行模块打包，这时需要一个入口文件`index.js`，里面可以配置路由，store等等


## 其他注意事项

1. 在业务模块vue文件中不能引入`路由文件`否则会打包路由位置的相应模块到业务模块目录